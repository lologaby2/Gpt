import os
import telebot
from flask import Flask, request

BOT_TOKEN = "7999893111:AAGe_NUHgeelBTXK496jrHeug11vsiWQDKk"
bot = telebot.TeleBot(BOT_TOKEN)
app = Flask(__name__)

TEXT_TOP = """قم بترجمة النص للعربي بما يلائم فيديو شورت مدته (    ) ثانية و حافظ على تدفق النص بسلاسة،قم باستبدال اسماء الاشخاص ان وجدت 
ب(الرجل،المرأة،الفتاة،الطفل،الشاب......) و 
هكذا،ساستخدم هذا النص لتوليد صوت بالذكاء 
الاصطناعي لذلك اضف علامات الترقيم كالتعجب و 
الفواصل و النقاط الشارحة و لا تضف اي نقطة الا في 
النهاية ، و اقترح خمسة هوكات بنص منفصل اسفل الترجمة على بنفس نمط هذه الهوكات:
1-لا تقم ابدا بالخطأ الذي ارتكبه هذا الشاب.
2-اعتقد هذا الرجل انه اصيب بطلق ناري.
3-عندما يدخل عليك لص ، لكنك تنجو بسبب شجاعتك.
4-اذا رأيت فأرا يطارد قطا في الطريق فعليك ان تنتبه.
5-هذا الصندوق كان مغلقًا منذ 100 عام ، شاهد ما وجدنا بداخله!".
6-اخبر هذا الطفل الاطباء انه لن يفقد وعيه عند تخديره بالمخدر.
7-ارتكب هذا القاتل المتسلسل جريمته الاولى، و الان امام الشرطة ساعتان لايقافه قبل ان يهرب
8-بدأت المرأة تشك أن هذا العالم قد لا يكون حقيقياً. 
9-بعدما سرق اللصوص الأموال، قاموا برميها من السماء على الناس، مما أثار استغراب الشرطة!
10-بعد أن ظنت أنه رجل سيء، قررت قتله… لكنها كانت مخطئة! 
النص:"""

TEXT_BOTTOM = """اريد ان يحتوي ردك على النص و الهوكات بالاسفل فقط بدون اي اضافة او تعليق او عبارات خدمة مثل ساقوم بما تريد او حاضر او ساترجم النص كما طلبت، اريد النص فقط."""

@bot.message_handler(func=lambda message: True)
def handle_message(message):
    user_text = message.text
    reply = f"{TEXT_TOP}\n\n{user_text}\n\n{TEXT_BOTTOM}"
    bot.send_message(message.chat.id, reply)

@app.route(f"/{BOT_TOKEN}", methods=["POST"])
def webhook():
    update = telebot.types.Update.de_json(request.stream.read().decode("utf-8"))
    bot.process_new_updates([update])
    return "OK", 200

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=int(os.environ.get("PORT", 5000)))
